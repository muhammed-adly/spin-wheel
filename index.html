<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fancy Spin the Wheel</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box; margin: 0; padding: 0;
    }
    html, body {
      height: 100%; width: 100%;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background: #f9f9f9;
      color: #333;
      text-align: center;
      padding: 20px;
    }
    header, footer {
      background: #fff;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    h1 {
      font-size: 2.4em;
      color: #8e44ad;
      margin-bottom: 0;
    }
    .btn {
      font-size: 16px;
      padding: 10px 20px;
      cursor: pointer;
      background: linear-gradient(45deg, #8e44ad, #3498db);
      border: none;
      border-radius: 25px;
      color: #fff;
      transition: background 0.3s, transform 0.2s;
      margin: 20px auto;
      display: inline-block;
    }
    .btn:hover {
      background: linear-gradient(45deg, #732d91, #2980b9);
      transform: scale(1.05);
    }
    /* Wheel container */
    #wheelContainer {
      position: relative;
      max-width: 600px;
      margin: 0 auto;
    }
    #wheelCanvas {
      width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
      border-radius: 50%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    /* The star pointer */
    #starPointer {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%) translateY(-45px);
      font-size: 36px;
      z-index: 10;
      pointer-events: none;
    }
    /* Center message overlay */
    #centerMessage {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 1.2em;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
      pointer-events: none;
      width: 80%;
      max-width: 300px;
      line-height: 1.4;
    }
    /* Celebration popup */
    #popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center; align-items: center;
      z-index: 9999;
    }
    #popupContent {
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      text-align: center;
      max-width: 90%;
      margin: auto;
    }
    #popup h2 {
      margin-bottom: 15px;
      color: #8e44ad;
    }
  </style>
</head>
<body>

<header>
  <h1>Fancy Spin the Wheel</h1>
</header>

<main>
  <div id="wheelContainer">
    <!-- Star Pointer -->
    <div id="starPointer">⭐</div>
    <!-- Canvas for the wheel -->
    <canvas id="wheelCanvas" width="500" height="500"></canvas>
    <!-- Center message -->
    <div id="centerMessage">Click OR Press (Ctrl + Enter) to spin</div>
  </div>

  <br>
  <button id="spinBtn" class="btn">Spin!</button>
</main>

<!-- Celebration popup -->
<div id="popup">
  <div id="popupContent">
    <h2>Congratulations!</h2>
    <p id="popupResult"></p>
    <button id="closePopup" class="btn">Close</button>
  </div>
</div>

<footer>
  <p>&copy; 2025 Fancy Wheel. All rights reserved.</p>
</footer>

<script>
  /************************************************************
   * CONFIGURABLE PARTS
   ************************************************************/
  // Example: many items (including emojis)
  // Feel free to replace or add more items
  const segments = [
    "Lion 🦁", "Tiger 🐯", "Elephant 🐘", "Zebra 🦓", "Monkey 🐒",
    "Kangaroo 🦘", "Bear 🧸", "Frog 🐸", "Horse 🐴", "Giraffe 🦒",
    "Hippo 🦛", "Rhino 🦏", "Fox 🦊", "Wolf 🐺", "Goat 🐐",
    "Rabbit 🐇", "Panda 🐼", "Duck 🦆", "Turkey 🦃", "Octopus 🐙",
    "Shark 🦈", "Penguin 🐧", "Chicken 🐔", "Snake 🐍", "Camel 🐪",
    "Whale 🐳", "Dolphin 🐬", "Koala 🐨", "Lizard 🦎", "Crocodile 🐊",
  ];

  // How many seconds of spin (between 4 and 7)
  const MIN_SPIN_MS = 4000;
  const MAX_SPIN_MS = 7000;
  // Maximum spin angle in degrees
  const MIN_ANGLE = 1000;
  const MAX_ANGLE = 2000;

  /************************************************************
   * INTERNALS
   ************************************************************/
  const canvas = document.getElementById("wheelCanvas");
  const ctx = canvas.getContext("2d");
  const spinBtn = document.getElementById("spinBtn");
  const popup = document.getElementById("popup");
  const popupResult = document.getElementById("popupResult");
  const closePopup = document.getElementById("closePopup");
  const centerMessage = document.getElementById("centerMessage");

  // For a dynamic color scheme
  const colors = [];
  let startAngle = 0;        // The wheel's rotation
  let arc = Math.PI * 2 / segments.length;
  let spinTime = 0;
  let spinTimeTotal = 0;
  let spinAngleTotal = 0;

  // Idle rotation variables
  let idleReqId = null;
  let hasSpun = false;

  // Generate colors
  function generateColors() {
    for (let i = 0; i < segments.length; i++) {
      const hue = Math.floor((360 * i) / segments.length);
      colors[i] = `hsl(${hue}, 70%, 50%)`;
    }
  }

  // Easing function for a smooth deceleration (easeOutQuart)
  function easeOutQuart(t, b, c, d) {
    t /= d; t--;
    return -c * (t*t*t*t - 1) + b;
  }

  // Draw the wheel
  function drawWheel() {
    const size = canvas.width;
    const center = size / 2;
    const outerRadius = center - 10;
    const innerRadius = size * 0.06; // small circle at center
    ctx.clearRect(0, 0, size, size);
    ctx.lineWidth = 2;
    ctx.strokeStyle = "#fff";
    ctx.font = "bold 16px 'Poppins', sans-serif";

    arc = (Math.PI * 2) / segments.length;

    for (let i = 0; i < segments.length; i++) {
      // Start angle for the slice
      const sliceAngle = startAngle + i * arc;
      // Draw slice
      ctx.fillStyle = colors[i];
      ctx.beginPath();
      ctx.arc(center, center, outerRadius, sliceAngle, sliceAngle + arc, false);
      ctx.arc(center, center, innerRadius, sliceAngle + arc, sliceAngle, true);
      ctx.fill();
      ctx.stroke();

      // Draw text along the arc, tangent to the circle
      ctx.save();
      ctx.fillStyle = "#fff";
      const midAngle = sliceAngle + arc / 2;
      ctx.translate(center, center);
      ctx.rotate(midAngle);
      // Move outward to place text near the outer edge
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      // We'll place text slightly in from the edge
      const textRadius = outerRadius * 0.8;
      // Wrap text if needed
      const label = segments[i];
      const maxTextWidth = arc * textRadius; // approximate space for each arc
      // We'll measure and break lines manually
      const lines = wrapTextLines(ctx, label, maxTextWidth);

      // The total height of the lines
      const lineHeight = 18;
      const totalHeight = lines.length * lineHeight;
      let offsetY = -((lines.length - 1) / 2) * lineHeight;

      // Move to the radius where text should appear
      ctx.translate(0, -textRadius);

      // Draw each line
      for (let l = 0; l < lines.length; l++) {
        ctx.fillText(lines[l], 0, offsetY + l * lineHeight);
      }
      ctx.restore();
    }

    // If we want to show the center circle
    // ctx.save();
    // ctx.fillStyle = "#fff";
    // ctx.beginPath();
    // ctx.arc(center, center, innerRadius, 0, 2 * Math.PI);
    // ctx.fill();
    // ctx.restore();
  }

  // Simple function to wrap text into lines
  function wrapTextLines(ctx, text, maxWidth) {
    const words = text.split(" ");
    let currentLine = words[0];
    const lines = [];
    for (let i = 1; i < words.length; i++) {
      const testLine = currentLine + " " + words[i];
      if (ctx.measureText(testLine).width < maxWidth) {
        currentLine = testLine;
      } else {
        lines.push(currentLine);
        currentLine = words[i];
      }
    }
    lines.push(currentLine);
    return lines;
  }

  // Idle rotation
  function idleRotate() {
    if (hasSpun) return; // Stop if user has spun
    startAngle += 0.005;
    drawWheel();
    idleReqId = requestAnimationFrame(idleRotate);
  }

  // Spin the wheel
  function rotateWheel() {
    spinTime += 30;
    if (spinTime >= spinTimeTotal) {
      stopRotateWheel();
      return;
    }
    const spinAngle = easeOutQuart(spinTime, 0, spinAngleTotal, spinTimeTotal);
    startAngle += (spinAngle * Math.PI) / 180;
    drawWheel();
    requestAnimationFrame(rotateWheel);
  }

  // Stop the wheel, show result
  function stopRotateWheel() {
    // pointer is at "top" => offset 90 deg
    const degrees = (startAngle * 180) / Math.PI + 90;
    const arcd = (arc * 180) / Math.PI;
    const index = Math.floor((360 - (degrees % 360)) / arcd);
    showResult(segments[index]);
  }

  // Show result in popup
  function showResult(label) {
    popupResult.textContent = `You won: ${label}!`;
    popup.style.display = "flex";
  }

  // Spin button event
  spinBtn.addEventListener("click", () => {
    // Stop idle rotation
    if (!hasSpun) {
      hasSpun = true;
      cancelAnimationFrame(idleReqId);
    }
    spinTime = 0;
    spinTimeTotal = Math.random() * (MAX_SPIN_MS - MIN_SPIN_MS) + MIN_SPIN_MS;
    spinAngleTotal = Math.random() * (MAX_ANGLE - MIN_ANGLE) + MIN_ANGLE;
    rotateWheel();
  });

  // Keyboard shortcut: Ctrl+Enter => Spin
  document.addEventListener("keydown", (e) => {
    if (e.ctrlKey && e.key === "Enter") {
      spinBtn.click();
    }
  });

  // Close popup
  closePopup.addEventListener("click", () => {
    popup.style.display = "none";
  });

  // Generate colors, set up wheel
  generateColors();
  drawWheel();
  idleReqId = requestAnimationFrame(idleRotate);

</script>
</body>
</html>
